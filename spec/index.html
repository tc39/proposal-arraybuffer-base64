<!doctype html>
<head><meta charset="utf-8">
<title>Uint8Array to/from base64</title><script src="ecmarkup.js?cache=q4FhX7An" defer=""></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/styles/base16/solarized-light.min.css"><link rel="stylesheet" href="ecmarkup.css"></head><body><div id="shortcuts-help">
<ul>
  <li><span>Toggle shortcuts help</span><code>?</code></li>
  <li><span>Toggle "can call user code" annotations</span><code>u</code></li>

  <li><span>Jump to search box</span><code>/</code></li>
</ul></div><div id="menu-toggle"><svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%; stroke:currentColor" viewBox="0 0 120 120">
      <title>Menu</title>
      <path stroke-width="10" stroke-linecap="round" d="M30,60 h60  M30,30 m0,5 h60  M30,90 m0,-5 h60"></path>
    </svg></div><div id="menu-spacer" class="menu-spacer"></div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-pins"><div class="menu-pane-header">Pins</div><ul id="menu-pins-list"></ul></div><div class="menu-pane-header">Table of Contents</div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-uint8array.prototype.tobase64" title="Uint8Array.prototype.toBase64 ( [ options ] )"><span class="secnum">1</span> Uint8Array.prototype.toBase64 ( [ <var>options</var> ] )</a></li><li><span class="item-toggle-none"></span><a href="#sec-uint8array.prototype.tohex" title="Uint8Array.prototype.toHex ( )"><span class="secnum">2</span> Uint8Array.prototype.toHex ( )</a></li><li><span class="item-toggle-none"></span><a href="#sec-uint8array.frombase64" title="Uint8Array.fromBase64 ( string [ , options ] )"><span class="secnum">3</span> Uint8Array.fromBase64 ( <var>string</var> [ , <var>options</var> ] )</a></li><li><span class="item-toggle-none"></span><a href="#sec-uint8array.prototype.setfrombase64" title="Uint8Array.prototype.setFromBase64 ( string [ , options ] )"><span class="secnum">4</span> Uint8Array.prototype.setFromBase64 ( <var>string</var> [ , <var>options</var> ] )</a></li><li><span class="item-toggle-none"></span><a href="#sec-uint8array.fromhex" title="Uint8Array.fromHex ( string )"><span class="secnum">5</span> Uint8Array.fromHex ( <var>string</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-uint8array.prototype.setfromhex" title="Uint8Array.prototype.setFromHex ( string )"><span class="secnum">6</span> Uint8Array.prototype.setFromHex ( <var>string</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-validateuint8array" title="ValidateUint8Array ( ta )"><span class="secnum">7</span> ValidateUint8Array ( <var>ta</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-getuint8arraybytes" title="GetUint8ArrayBytes ( ta )"><span class="secnum">8</span> GetUint8ArrayBytes ( <var>ta</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-writeuint8arraybytes" title="SetUint8ArrayBytes ( into, bytes )"><span class="secnum">9</span> SetUint8ArrayBytes ( <var>into</var>, <var>bytes</var> )</a></li><li><span class="item-toggle">+</span><a href="#sec-helpers" title="Helpers"><span class="secnum">10</span> Helpers</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-skipasciiwhitespace" title="SkipAsciiWhitespace ( string, index )"><span class="secnum">10.1</span> SkipAsciiWhitespace ( <var>string</var>, <var>index</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-decodebase64chunk" title="DecodeBase64Chunk ( chunk [ , throwOnExtraBits ] )"><span class="secnum">10.2</span> DecodeBase64Chunk ( <var>chunk</var> [ , <var>throwOnExtraBits</var> ] )</a></li><li><span class="item-toggle-none"></span><a href="#sec-frombase64" title="FromBase64 ( string, alphabet, lastChunkHandling [ , maxLength ] )"><span class="secnum">10.3</span> FromBase64 ( <var>string</var>, <var>alphabet</var>, <var>lastChunkHandling</var> [ , <var>maxLength</var> ] )</a></li><li><span class="item-toggle-none"></span><a href="#sec-fromhex" title="FromHex ( string [ , maxLength ] )"><span class="secnum">10.4</span> FromHex ( <var>string</var> [ , <var>maxLength</var> ] )</a></li><li><span class="item-toggle-none"></span><a href="#sec-getoptionsobject" title="GetOptionsObject ( options )"><span class="secnum">10.5</span> GetOptionsObject ( <var>options</var> )</a></li></ol></li><li><span class="item-toggle-none"></span><a href="#sec-modified-bibliography" title="Bibliography"><span class="secnum">A</span> Bibliography</a></li></ol></div></div><div id="spec-container"><h1 class="version">Stage 4 Draft / October 28, 2025</h1><h1 class="title">Uint8Array to/from base64</h1>

<div id="metadata-block">
  <h1>Contributing to this Proposal</h1>
  <p>This proposal is developed <a href="https://github.com/tc39/proposal-arraybuffer-base64">on GitHub</a>. A <a href="https://tc39.es/proposal-arraybuffer-base64/">playground is available</a> with examples and a non-production polyfill to allow direct experimentation.</p>
</div>

<emu-clause id="sec-uint8array.prototype.tobase64">
  <h1><span class="secnum">1</span> Uint8Array.prototype.toBase64 ( [ <var>options</var> ] )</h1>
  <emu-alg><ol><li>Let <var>O</var> be the <emu-val>this</emu-val> value.</li><li>Perform ?&nbsp;<emu-xref aoid="ValidateUint8Array" id="_ref_0"><a href="#sec-validateuint8array">ValidateUint8Array</a></emu-xref>(<var>O</var>).</li><li>Let <var>opts</var> be ?&nbsp;<emu-xref aoid="GetOptionsObject" id="_ref_1"><a href="#sec-getoptionsobject">GetOptionsObject</a></emu-xref>(<var>options</var>).</li><li>Let <var>alphabet</var> be ?&nbsp;<emu-xref aoid="Get"><a href="https://tc39.es/ecma262/#sec-get-o-p" class="e-user-code">Get</a></emu-xref>(<var>opts</var>, <emu-val>"alphabet"</emu-val>).</li><li>If <var>alphabet</var> is <emu-val>undefined</emu-val>, set <var>alphabet</var> to <emu-val>"base64"</emu-val>.</li><li>If <var>alphabet</var> is neither <emu-val>"base64"</emu-val> nor <emu-val>"base64url"</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>omitPadding</var> be <emu-xref aoid="ToBoolean"><a href="https://tc39.es/ecma262/#sec-toboolean">ToBoolean</a></emu-xref>(? <emu-xref aoid="Get"><a href="https://tc39.es/ecma262/#sec-get-o-p" class="e-user-code">Get</a></emu-xref>(<var>opts</var>, <emu-val>"omitPadding"</emu-val>)).</li><li>Let <var>toEncode</var> be ?&nbsp;<emu-xref aoid="GetUint8ArrayBytes" id="_ref_2"><a href="#sec-getuint8arraybytes">GetUint8ArrayBytes</a></emu-xref>(<var>O</var>).</li><li>If <var>alphabet</var> is <emu-val>"base64"</emu-val>, then<ol><li>Let <var>outAscii</var> be the sequence of code points which results from encoding <var>toEncode</var> according to the base64 encoding specified in section 4 of <a href="https://datatracker.ietf.org/doc/html/rfc4648">RFC 4648</a>. Padding is included if and only if <var>omitPadding</var> is <emu-val>false</emu-val>.</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>alphabet</var> is <emu-val>"base64url"</emu-val>.</li><li>Let <var>outAscii</var> be the sequence of code points which results from encoding <var>toEncode</var> according to the base64url encoding specified in section 5 of <a href="https://datatracker.ietf.org/doc/html/rfc4648">RFC 4648</a>. Padding is included if and only if <var>omitPadding</var> is <emu-val>false</emu-val>.</li></ol></li><li>Return <emu-xref aoid="CodePointsToString"><a href="https://tc39.es/ecma262/#sec-codepointstostring">CodePointsToString</a></emu-xref>(<var>outAscii</var>).</li></ol></emu-alg>
</emu-clause>

<emu-clause id="sec-uint8array.prototype.tohex">
  <h1><span class="secnum">2</span> Uint8Array.prototype.toHex ( )</h1>
  <emu-alg><ol><li>Let <var>O</var> be the <emu-val>this</emu-val> value.</li><li>Perform ?&nbsp;<emu-xref aoid="ValidateUint8Array" id="_ref_3"><a href="#sec-validateuint8array">ValidateUint8Array</a></emu-xref>(<var>O</var>).</li><li>Let <var>toEncode</var> be ?&nbsp;<emu-xref aoid="GetUint8ArrayBytes" id="_ref_4"><a href="#sec-getuint8arraybytes">GetUint8ArrayBytes</a></emu-xref>(<var>O</var>).</li><li>Let <var>out</var> be the empty String.</li><li>For each byte <var>byte</var> of <var>toEncode</var>, do<ol><li>Let <var>hex</var> be <emu-xref aoid="Number::toString"><a href="https://tc39.es/ecma262/#sec-numeric-types-number-tostring">Number::toString</a></emu-xref>(<emu-xref aoid="ùîΩ"><a href="https://tc39.es/ecma262/#ùîΩ">ùîΩ</a></emu-xref>(<var>byte</var>), 16).</li><li>Set <var>hex</var> to <emu-xref aoid="StringPad"><a href="https://tc39.es/ecma262/#sec-stringpad">StringPad</a></emu-xref>(<var>hex</var>, 2, <emu-val>"0"</emu-val>, <emu-const>start</emu-const>).</li><li>Set <var>out</var> to the <emu-xref href="#string-concatenation"><a href="https://tc39.es/ecma262/#string-concatenation">string-concatenation</a></emu-xref> of <var>out</var> and <var>hex</var>.</li></ol></li><li>Return <var>out</var>.</li></ol></emu-alg>
</emu-clause>

<emu-clause id="sec-uint8array.frombase64">
  <h1><span class="secnum">3</span> Uint8Array.fromBase64 ( <var>string</var> [ , <var>options</var> ] )</h1>
  <emu-alg><ol><li>If <var>string</var> <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-string-type">is not a String</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>opts</var> be ?&nbsp;<emu-xref aoid="GetOptionsObject" id="_ref_5"><a href="#sec-getoptionsobject">GetOptionsObject</a></emu-xref>(<var>options</var>).</li><li>Let <var>alphabet</var> be ?&nbsp;<emu-xref aoid="Get"><a href="https://tc39.es/ecma262/#sec-get-o-p" class="e-user-code">Get</a></emu-xref>(<var>opts</var>, <emu-val>"alphabet"</emu-val>).</li><li>If <var>alphabet</var> is <emu-val>undefined</emu-val>, set <var>alphabet</var> to <emu-val>"base64"</emu-val>.</li><li>If <var>alphabet</var> is neither <emu-val>"base64"</emu-val> nor <emu-val>"base64url"</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>lastChunkHandling</var> be ?&nbsp;<emu-xref aoid="Get"><a href="https://tc39.es/ecma262/#sec-get-o-p" class="e-user-code">Get</a></emu-xref>(<var>opts</var>, <emu-val>"lastChunkHandling"</emu-val>).</li><li>If <var>lastChunkHandling</var> is <emu-val>undefined</emu-val>, set <var>lastChunkHandling</var> to <emu-val>"loose"</emu-val>.</li><li>If <var>lastChunkHandling</var> is not one of <emu-val>"loose"</emu-val>, <emu-val>"strict"</emu-val>, or <emu-val>"stop-before-partial"</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>result</var> be <emu-xref aoid="FromBase64" id="_ref_6"><a href="#sec-frombase64">FromBase64</a></emu-xref>(<var>string</var>, <var>alphabet</var>, <var>lastChunkHandling</var>).</li><li>If <var>result</var>.<var class="field">[[Error]]</var> is not <emu-const>none</emu-const>, then<ol><li>Throw <var>result</var>.<var class="field">[[Error]]</var>.</li></ol></li><li>Let <var>resultLength</var> be the length of <var>result</var>.<var class="field">[[Bytes]]</var>.</li><li>Let <var>ta</var> be ?&nbsp;<emu-xref aoid="AllocateTypedArray"><a href="https://tc39.es/ecma262/#sec-allocatetypedarray">AllocateTypedArray</a></emu-xref>(<emu-val>"Uint8Array"</emu-val>, <emu-xref href="#sec-typedarray-objects"><a href="https://tc39.es/ecma262/#sec-typedarray-objects">%Uint8Array%</a></emu-xref>, <emu-val>"%Uint8Array.prototype%"</emu-val>, <var>resultLength</var>).</li><li>Set the value at each index of <var>ta</var>.<var class="field">[[ViewedArrayBuffer]]</var>.<var class="field">[[ArrayBufferData]]</var> to the value at the corresponding index of <var>result</var>.<var class="field">[[Bytes]]</var>.</li><li>Return <var>ta</var>.</li></ol></emu-alg>
</emu-clause>

<emu-clause id="sec-uint8array.prototype.setfrombase64">
  <h1><span class="secnum">4</span> Uint8Array.prototype.setFromBase64 ( <var>string</var> [ , <var>options</var> ] )</h1>
  <emu-alg><ol><li>Let <var>into</var> be the <emu-val>this</emu-val> value.</li><li>Perform ?&nbsp;<emu-xref aoid="ValidateUint8Array" id="_ref_7"><a href="#sec-validateuint8array">ValidateUint8Array</a></emu-xref>(<var>into</var>).</li><li>If <var>string</var> <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-string-type">is not a String</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>opts</var> be ?&nbsp;<emu-xref aoid="GetOptionsObject" id="_ref_8"><a href="#sec-getoptionsobject">GetOptionsObject</a></emu-xref>(<var>options</var>).</li><li>Let <var>alphabet</var> be ?&nbsp;<emu-xref aoid="Get"><a href="https://tc39.es/ecma262/#sec-get-o-p" class="e-user-code">Get</a></emu-xref>(<var>opts</var>, <emu-val>"alphabet"</emu-val>).</li><li>If <var>alphabet</var> is <emu-val>undefined</emu-val>, set <var>alphabet</var> to <emu-val>"base64"</emu-val>.</li><li>If <var>alphabet</var> is neither <emu-val>"base64"</emu-val> nor <emu-val>"base64url"</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>lastChunkHandling</var> be ?&nbsp;<emu-xref aoid="Get"><a href="https://tc39.es/ecma262/#sec-get-o-p" class="e-user-code">Get</a></emu-xref>(<var>opts</var>, <emu-val>"lastChunkHandling"</emu-val>).</li><li>If <var>lastChunkHandling</var> is <emu-val>undefined</emu-val>, set <var>lastChunkHandling</var> to <emu-val>"loose"</emu-val>.</li><li>If <var>lastChunkHandling</var> is not one of <emu-val>"loose"</emu-val>, <emu-val>"strict"</emu-val>, or <emu-val>"stop-before-partial"</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>taRecord</var> be <emu-xref aoid="MakeTypedArrayWithBufferWitnessRecord"><a href="https://tc39.es/ecma262/#sec-maketypedarraywithbufferwitnessrecord">MakeTypedArrayWithBufferWitnessRecord</a></emu-xref>(<var>into</var>, <emu-const>seq-cst</emu-const>).</li><li>If <emu-xref aoid="IsTypedArrayOutOfBounds"><a href="https://tc39.es/ecma262/#sec-istypedarrayoutofbounds">IsTypedArrayOutOfBounds</a></emu-xref>(<var>taRecord</var>) is <emu-val>true</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>byteLength</var> be <emu-xref aoid="TypedArrayLength"><a href="https://tc39.es/ecma262/#sec-typedarraylength">TypedArrayLength</a></emu-xref>(<var>taRecord</var>).</li><li>Let <var>result</var> be <emu-xref aoid="FromBase64" id="_ref_9"><a href="#sec-frombase64">FromBase64</a></emu-xref>(<var>string</var>, <var>alphabet</var>, <var>lastChunkHandling</var>, <var>byteLength</var>).</li><li>Let <var>bytes</var> be <var>result</var>.<var class="field">[[Bytes]]</var>.</li><li>Let <var>written</var> be the length of <var>bytes</var>.</li><li>NOTE: <emu-xref aoid="FromBase64" id="_ref_10"><a href="#sec-frombase64">FromBase64</a></emu-xref> does not invoke any user code, so the ArrayBuffer backing <var>into</var> cannot have been detached or shrunk.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>written</var> ‚â§ <var>byteLength</var>.</li><li>Perform <emu-xref aoid="SetUint8ArrayBytes" id="_ref_11"><a href="#sec-writeuint8arraybytes">SetUint8ArrayBytes</a></emu-xref>(<var>into</var>, <var>bytes</var>).</li><li>If <var>result</var>.<var class="field">[[Error]]</var> is not <emu-const>none</emu-const>, then<ol><li>Throw <var>result</var>.<var class="field">[[Error]]</var>.</li></ol></li><li>Let <var>resultObject</var> be <emu-xref aoid="OrdinaryObjectCreate"><a href="https://tc39.es/ecma262/#sec-ordinaryobjectcreate">OrdinaryObjectCreate</a></emu-xref>(<emu-xref href="#sec-properties-of-the-object-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-object-prototype-object">%Object.prototype%</a></emu-xref>).</li><li>Perform !&nbsp;<emu-xref aoid="CreateDataPropertyOrThrow"><a href="https://tc39.es/ecma262/#sec-createdatapropertyorthrow">CreateDataPropertyOrThrow</a></emu-xref>(<var>resultObject</var>, <emu-val>"read"</emu-val>, <emu-xref aoid="ùîΩ"><a href="https://tc39.es/ecma262/#ùîΩ">ùîΩ</a></emu-xref>(<var>result</var>.<var class="field">[[Read]]</var>)).</li><li>Perform !&nbsp;<emu-xref aoid="CreateDataPropertyOrThrow"><a href="https://tc39.es/ecma262/#sec-createdatapropertyorthrow">CreateDataPropertyOrThrow</a></emu-xref>(<var>resultObject</var>, <emu-val>"written"</emu-val>, <emu-xref aoid="ùîΩ"><a href="https://tc39.es/ecma262/#ùîΩ">ùîΩ</a></emu-xref>(<var>written</var>)).</li><li>Return <var>resultObject</var>.</li></ol></emu-alg>
</emu-clause>

<emu-clause id="sec-uint8array.fromhex">
  <h1><span class="secnum">5</span> Uint8Array.fromHex ( <var>string</var> )</h1>
  <emu-alg><ol><li>If <var>string</var> <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-string-type">is not a String</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>result</var> be <emu-xref aoid="FromHex" id="_ref_12"><a href="#sec-fromhex">FromHex</a></emu-xref>(<var>string</var>).</li><li>If <var>result</var>.<var class="field">[[Error]]</var> is not <emu-const>none</emu-const>, then<ol><li>Throw <var>result</var>.<var class="field">[[Error]]</var>.</li></ol></li><li>Let <var>resultLength</var> be the length of <var>result</var>.<var class="field">[[Bytes]]</var>.</li><li>Let <var>ta</var> be ?&nbsp;<emu-xref aoid="AllocateTypedArray"><a href="https://tc39.es/ecma262/#sec-allocatetypedarray">AllocateTypedArray</a></emu-xref>(<emu-val>"Uint8Array"</emu-val>, <emu-xref href="#sec-typedarray-objects"><a href="https://tc39.es/ecma262/#sec-typedarray-objects">%Uint8Array%</a></emu-xref>, <emu-val>"%Uint8Array.prototype%"</emu-val>, <var>resultLength</var>).</li><li>Set the value at each index of <var>ta</var>.<var class="field">[[ViewedArrayBuffer]]</var>.<var class="field">[[ArrayBufferData]]</var> to the value at the corresponding index of <var>result</var>.<var class="field">[[Bytes]]</var>.</li><li>Return <var>ta</var>.</li></ol></emu-alg>
</emu-clause>

<emu-clause id="sec-uint8array.prototype.setfromhex">
  <h1><span class="secnum">6</span> Uint8Array.prototype.setFromHex ( <var>string</var> )</h1>
  <emu-alg><ol><li>Let <var>into</var> be the <emu-val>this</emu-val> value.</li><li>Perform ?&nbsp;<emu-xref aoid="ValidateUint8Array" id="_ref_13"><a href="#sec-validateuint8array">ValidateUint8Array</a></emu-xref>(<var>into</var>).</li><li>If <var>string</var> <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-string-type">is not a String</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>taRecord</var> be <emu-xref aoid="MakeTypedArrayWithBufferWitnessRecord"><a href="https://tc39.es/ecma262/#sec-maketypedarraywithbufferwitnessrecord">MakeTypedArrayWithBufferWitnessRecord</a></emu-xref>(<var>into</var>, <emu-const>seq-cst</emu-const>).</li><li>If <emu-xref aoid="IsTypedArrayOutOfBounds"><a href="https://tc39.es/ecma262/#sec-istypedarrayoutofbounds">IsTypedArrayOutOfBounds</a></emu-xref>(<var>taRecord</var>) is <emu-val>true</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>byteLength</var> be <emu-xref aoid="TypedArrayLength"><a href="https://tc39.es/ecma262/#sec-typedarraylength">TypedArrayLength</a></emu-xref>(<var>taRecord</var>).</li><li>Let <var>result</var> be <emu-xref aoid="FromHex" id="_ref_14"><a href="#sec-fromhex">FromHex</a></emu-xref>(<var>string</var>, <var>byteLength</var>).</li><li>Let <var>bytes</var> be <var>result</var>.<var class="field">[[Bytes]]</var>.</li><li>Let <var>written</var> be the length of <var>bytes</var>.</li><li>NOTE: <emu-xref aoid="FromHex" id="_ref_15"><a href="#sec-fromhex">FromHex</a></emu-xref> does not invoke any user code, so the ArrayBuffer backing <var>into</var> cannot have been detached or shrunk.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>written</var> ‚â§ <var>byteLength</var>.</li><li>Perform <emu-xref aoid="SetUint8ArrayBytes" id="_ref_16"><a href="#sec-writeuint8arraybytes">SetUint8ArrayBytes</a></emu-xref>(<var>into</var>, <var>bytes</var>).</li><li>If <var>result</var>.<var class="field">[[Error]]</var> is not <emu-const>none</emu-const>, then<ol><li>Throw <var>result</var>.<var class="field">[[Error]]</var>.</li></ol></li><li>Let <var>resultObject</var> be <emu-xref aoid="OrdinaryObjectCreate"><a href="https://tc39.es/ecma262/#sec-ordinaryobjectcreate">OrdinaryObjectCreate</a></emu-xref>(<emu-xref href="#sec-properties-of-the-object-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-object-prototype-object">%Object.prototype%</a></emu-xref>).</li><li>Perform !&nbsp;<emu-xref aoid="CreateDataPropertyOrThrow"><a href="https://tc39.es/ecma262/#sec-createdatapropertyorthrow">CreateDataPropertyOrThrow</a></emu-xref>(<var>resultObject</var>, <emu-val>"read"</emu-val>, <emu-xref aoid="ùîΩ"><a href="https://tc39.es/ecma262/#ùîΩ">ùîΩ</a></emu-xref>(<var>result</var>.<var class="field">[[Read]]</var>)).</li><li>Perform !&nbsp;<emu-xref aoid="CreateDataPropertyOrThrow"><a href="https://tc39.es/ecma262/#sec-createdatapropertyorthrow">CreateDataPropertyOrThrow</a></emu-xref>(<var>resultObject</var>, <emu-val>"written"</emu-val>, <emu-xref aoid="ùîΩ"><a href="https://tc39.es/ecma262/#ùîΩ">ùîΩ</a></emu-xref>(<var>written</var>)).</li><li>Return <var>resultObject</var>.</li></ol></emu-alg>
</emu-clause>

<emu-clause id="sec-validateuint8array" type="abstract operation" aoid="ValidateUint8Array">
  <h1><span class="secnum">7</span> ValidateUint8Array ( <var>ta</var> )</h1>
  <p>The abstract operation ValidateUint8Array takes argument <var>ta</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> <emu-const>unused</emu-const> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
  <emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>ta</var>, <var class="field">[[TypedArrayName]]</var>).</li><li>If <var>ta</var>.<var class="field">[[TypedArrayName]]</var> is not <emu-val>"Uint8Array"</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
</emu-clause>

<emu-clause id="sec-getuint8arraybytes" type="abstract operation" aoid="GetUint8ArrayBytes">
  <h1><span class="secnum">8</span> GetUint8ArrayBytes ( <var>ta</var> )</h1>
  <p>The abstract operation GetUint8ArrayBytes takes argument <var>ta</var> (a Uint8Array) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
  <emu-alg><ol><li>Let <var>buffer</var> be <var>ta</var>.<var class="field">[[ViewedArrayBuffer]]</var>.</li><li>Let <var>taRecord</var> be <emu-xref aoid="MakeTypedArrayWithBufferWitnessRecord"><a href="https://tc39.es/ecma262/#sec-maketypedarraywithbufferwitnessrecord">MakeTypedArrayWithBufferWitnessRecord</a></emu-xref>(<var>ta</var>, <emu-const>seq-cst</emu-const>).</li><li>If <emu-xref aoid="IsTypedArrayOutOfBounds"><a href="https://tc39.es/ecma262/#sec-istypedarrayoutofbounds">IsTypedArrayOutOfBounds</a></emu-xref>(<var>taRecord</var>) is <emu-val>true</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>len</var> be <emu-xref aoid="TypedArrayLength"><a href="https://tc39.es/ecma262/#sec-typedarraylength">TypedArrayLength</a></emu-xref>(<var>taRecord</var>).</li><li>Let <var>byteOffset</var> be <var>ta</var>.<var class="field">[[ByteOffset]]</var>.</li><li>Let <var>bytes</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>index</var> be 0.</li><li>Repeat, while <var>index</var> &lt; <var>len</var>,<ol><li>Let <var>byteIndex</var> be <var>byteOffset</var> + <var>index</var>.</li><li>Let <var>byte</var> be <emu-xref aoid="‚Ñù"><a href="https://tc39.es/ecma262/#‚Ñù">‚Ñù</a></emu-xref>(<emu-xref aoid="GetValueFromBuffer"><a href="https://tc39.es/ecma262/#sec-getvaluefrombuffer">GetValueFromBuffer</a></emu-xref>(<var>buffer</var>, <var>byteIndex</var>, <emu-const>uint8</emu-const>, <emu-val>true</emu-val>, <emu-const>unordered</emu-const>)).</li><li>Append <var>byte</var> to <var>bytes</var>.</li><li>Set <var>index</var> to <var>index</var> + 1.</li></ol></li><li>Return <var>bytes</var>.</li></ol></emu-alg>
</emu-clause>

<emu-clause id="sec-writeuint8arraybytes" type="abstract operation" aoid="SetUint8ArrayBytes">
  <h1><span class="secnum">9</span> SetUint8ArrayBytes ( <var>into</var>, <var>bytes</var> )</h1>
  <p>The abstract operation SetUint8ArrayBytes takes arguments <var>into</var> (a Uint8Array) and <var>bytes</var> (a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref>) and returns <emu-const>unused</emu-const>. It performs the following steps when called:</p>
  <emu-alg><ol><li>Let <var>offset</var> be <var>into</var>.<var class="field">[[ByteOffset]]</var>.</li><li>Let <var>len</var> be the length of <var>bytes</var>.</li><li>Let <var>index</var> be 0.</li><li>Repeat, while <var>index</var> &lt; <var>len</var>,<ol><li>Let <var>byte</var> be <var>bytes</var>[<var>index</var>].</li><li>Let <var>byteIndexInBuffer</var> be <var>index</var> + <var>offset</var>.</li><li>Perform <emu-xref aoid="SetValueInBuffer"><a href="https://tc39.es/ecma262/#sec-setvalueinbuffer">SetValueInBuffer</a></emu-xref>(<var>into</var>.<var class="field">[[ViewedArrayBuffer]]</var>, <var>byteIndexInBuffer</var>, <emu-const>uint8</emu-const>, <emu-xref aoid="ùîΩ"><a href="https://tc39.es/ecma262/#ùîΩ">ùîΩ</a></emu-xref>(<var>byte</var>), <emu-val>true</emu-val>, <emu-const>unordered</emu-const>).</li><li>Set <var>index</var> to <var>index</var> + 1.</li></ol></li></ol></emu-alg>
</emu-clause>

<emu-clause id="sec-helpers">
  <h1><span class="secnum">10</span> Helpers</h1>

  <emu-clause id="sec-skipasciiwhitespace" type="abstract operation" aoid="SkipAsciiWhitespace">
    <h1><span class="secnum">10.1</span> SkipAsciiWhitespace ( <var>string</var>, <var>index</var> )</h1>
    <p>The abstract operation SkipAsciiWhitespace takes arguments <var>string</var> (a string) and <var>index</var> (a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref>) and returns a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref>. It performs the following steps when called:</p>
    <emu-alg><ol><li>Let <var>length</var> be the length of <var>string</var>.</li><li>Repeat, while <var>index</var> &lt; <var>length</var>,<ol><li>Let <var>char</var> be the code unit at index <var>index</var> of <var>string</var>.</li><li>If <var>char</var> is neither 0x0009 (TAB), 0x000A (LF), 0x000C (FF), 0x000D (CR), nor 0x0020 (SPACE), then<ol><li>Return <var>index</var>.</li></ol></li><li>Set <var>index</var> to <var>index</var> + 1.</li></ol></li><li>Return <var>index</var>.</li></ol></emu-alg>
  </emu-clause>

  <emu-clause id="sec-decodebase64chunk" type="abstract operation" aoid="DecodeBase64Chunk">
    <h1><span class="secnum">10.2</span> DecodeBase64Chunk ( <var>chunk</var> [ , <var>throwOnExtraBits</var> ] )</h1>
    <p>The abstract operation DecodeBase64Chunk takes argument <var>chunk</var> (a string) and optional argument <var>throwOnExtraBits</var> (a boolean) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref>, or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>.</p>
    <p>The <dfn id="standard-base64-alphabet" tabindex="-1">standard base64 alphabet</dfn> is the String whose elements are the code units corresponding to every letter and number in the Unicode Basic Latin block along with <emu-val>"+"</emu-val> and <emu-val>"/"</emu-val>; that is, it is <emu-val>"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</emu-val>.</p>
    <emu-alg><ol><li>Let <var>chunkLength</var> be the length of <var>chunk</var>.</li><li>If <var>chunkLength</var> is 2, then<ol><li>Set <var>chunk</var> to the <emu-xref href="#string-concatenation"><a href="https://tc39.es/ecma262/#string-concatenation">string-concatenation</a></emu-xref> of <var>chunk</var> and <emu-val>"AA"</emu-val>.</li></ol></li><li>Else if <var>chunkLength</var> is 3, then<ol><li>Set <var>chunk</var> to the <emu-xref href="#string-concatenation"><a href="https://tc39.es/ecma262/#string-concatenation">string-concatenation</a></emu-xref> of <var>chunk</var> and <emu-val>"A"</emu-val>.</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>chunkLength</var> is 4.</li></ol></li><li>Let <var>byteSequence</var> be the unique sequence of 3 bytes resulting from decoding <var>chunk</var> as base64 (such that applying the base64 encoding specified in section 4 of <a href="https://datatracker.ietf.org/doc/html/rfc4648">RFC 4648</a> to <var>byteSequence</var> would produce <var>chunk</var>).</li><li>Let <var>bytes</var> be a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> whose elements are the elements of <var>byteSequence</var>, in order.</li><li>If <var>chunkLength</var> is 2, then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>throwOnExtraBits</var> is present.</li><li>If <var>throwOnExtraBits</var> is <emu-val>true</emu-val> and <var>bytes</var>[1] ‚â† 0, then<ol><li>Throw a <emu-val>SyntaxError</emu-val> exception.</li></ol></li><li>Return ¬´ <var>bytes</var>[0]&nbsp;¬ª.</li></ol></li><li>Else if <var>chunkLength</var> is 3, then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>throwOnExtraBits</var> is present.</li><li>If <var>throwOnExtraBits</var> is <emu-val>true</emu-val> and <var>bytes</var>[2] ‚â† 0, then<ol><li>Throw a <emu-val>SyntaxError</emu-val> exception.</li></ol></li><li>Return ¬´ <var>bytes</var>[0], <var>bytes</var>[1]&nbsp;¬ª.</li></ol></li><li>Else,<ol><li>Return <var>bytes</var>.</li></ol></li></ol></emu-alg>
  </emu-clause>

  <emu-clause id="sec-frombase64" type="abstract operation" aoid="FromBase64">
    <h1><span class="secnum">10.3</span> FromBase64 ( <var>string</var>, <var>alphabet</var>, <var>lastChunkHandling</var> [ , <var>maxLength</var> ] )</h1>
    <p>The abstract operation FromBase64 takes arguments <var>string</var> (a string), <var>alphabet</var> (<emu-val>"base64"</emu-val> or <emu-val>"base64url"</emu-val>), and <var>lastChunkHandling</var> (<emu-val>"loose"</emu-val>, <emu-val>"strict"</emu-val>, or <emu-val>"stop-before-partial"</emu-val>) and optional argument <var>maxLength</var> (a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref>) and returns a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> with fields <var class="field">[[Read]]</var> (an <emu-xref href="#integral-number"><a href="https://tc39.es/ecma262/#integral-number">integral Number</a></emu-xref>), <var class="field">[[Bytes]]</var> (a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref>), and <var class="field">[[Error]]</var> (either <emu-const>none</emu-const> or a <emu-val>SyntaxError</emu-val> object). It performs the following steps when called:</p>
    <emu-alg><ol><li>If <var>maxLength</var> is not present, then<ol><li>Let <var>maxLength</var> be 2<sup>53</sup> - 1.</li><li>NOTE: Because the input is a string, the length of strings is limited to 2<sup>53</sup> - 1 characters, and the output requires no more bytes than the input has characters, this limit can never be reached. However, it is editorially convenient to use a <emu-xref href="#finite"><a href="https://tc39.es/ecma262/#finite">finite</a></emu-xref> value here.</li></ol></li><li>NOTE: The order of validation and decoding in the algorithm below is not observable. Implementations are encouraged to perform them in whatever order is most efficient, possibly interleaving validation with decoding, as long as the behaviour is observably equivalent.</li><li>If <var>maxLength</var> is 0, then<ol><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: 0, <var class="field">[[Bytes]]</var>: ¬´&nbsp;¬ª, <var class="field">[[Error]]</var>: <emu-const>none</emu-const>&nbsp;}.</li></ol></li><li>Let <var>read</var> be 0.</li><li>Let <var>bytes</var> be ¬´&nbsp;¬ª.</li><li>Let <var>chunk</var> be the empty String.</li><li>Let <var>chunkLength</var> be 0.</li><li>Let <var>index</var> be 0.</li><li>Let <var>length</var> be the length of <var>string</var>.</li><li>Repeat,<ol><li>Set <var>index</var> to <emu-xref aoid="SkipAsciiWhitespace" id="_ref_17"><a href="#sec-skipasciiwhitespace">SkipAsciiWhitespace</a></emu-xref>(<var>string</var>, <var>index</var>).</li><li>If <var>index</var> = <var>length</var>, then<ol><li>If <var>chunkLength</var> &gt; 0, then<ol><li>If <var>lastChunkHandling</var> is <emu-val>"stop-before-partial"</emu-val>, then<ol><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <emu-const>none</emu-const>&nbsp;}.</li></ol></li><li>Else if <var>lastChunkHandling</var> is <emu-val>"loose"</emu-val>, then<ol><li>If <var>chunkLength</var> is 1, then<ol><li>Let <var>error</var> be a new <emu-val>SyntaxError</emu-val> exception.</li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <var>error</var>&nbsp;}.</li></ol></li><li>Set <var>bytes</var> to the <emu-xref href="#list-concatenation"><a href="https://tc39.es/ecma262/#list-concatenation">list-concatenation</a></emu-xref> of <var>bytes</var> and !&nbsp;<emu-xref aoid="DecodeBase64Chunk" id="_ref_18"><a href="#sec-decodebase64chunk">DecodeBase64Chunk</a></emu-xref>(<var>chunk</var>, <emu-val>false</emu-val>).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>lastChunkHandling</var> is <emu-val>"strict"</emu-val>.</li><li>Let <var>error</var> be a new <emu-val>SyntaxError</emu-val> exception.</li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <var>error</var>&nbsp;}.</li></ol></li></ol></li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>length</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <emu-const>none</emu-const>&nbsp;}.</li></ol></li><li>Let <var>char</var> be the <emu-xref href="#substring"><a href="https://tc39.es/ecma262/#substring">substring</a></emu-xref> of <var>string</var> from <var>index</var> to <var>index</var> + 1.</li><li>Set <var>index</var> to <var>index</var> + 1.</li><li>If <var>char</var> is <emu-val>"="</emu-val>, then<ol><li>If <var>chunkLength</var> &lt; 2, then<ol><li>Let <var>error</var> be a new <emu-val>SyntaxError</emu-val> exception.</li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <var>error</var>&nbsp;}.</li></ol></li><li>Set <var>index</var> to <emu-xref aoid="SkipAsciiWhitespace" id="_ref_19"><a href="#sec-skipasciiwhitespace">SkipAsciiWhitespace</a></emu-xref>(<var>string</var>, <var>index</var>).</li><li>If <var>chunkLength</var> = 2, then<ol><li>If <var>index</var> = <var>length</var>, then<ol><li>If <var>lastChunkHandling</var> is <emu-val>"stop-before-partial"</emu-val>, then<ol><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <emu-const>none</emu-const>&nbsp;}.</li></ol></li><li>Let <var>error</var> be a new <emu-val>SyntaxError</emu-val> exception.</li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <var>error</var>&nbsp;}.</li></ol></li><li>Set <var>char</var> to the <emu-xref href="#substring"><a href="https://tc39.es/ecma262/#substring">substring</a></emu-xref> of <var>string</var> from <var>index</var> to <var>index</var> + 1.</li><li>If <var>char</var> is <emu-val>"="</emu-val>, then<ol><li>Set <var>index</var> to <emu-xref aoid="SkipAsciiWhitespace" id="_ref_20"><a href="#sec-skipasciiwhitespace">SkipAsciiWhitespace</a></emu-xref>(<var>string</var>, <var>index</var> + 1).</li></ol></li></ol></li><li>If <var>index</var> &lt; <var>length</var>, then<ol><li>Let <var>error</var> be a new <emu-val>SyntaxError</emu-val> exception.</li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <var>error</var>&nbsp;}.</li></ol></li><li>If <var>lastChunkHandling</var> is <emu-val>"strict"</emu-val>, let <var>throwOnExtraBits</var> be <emu-val>true</emu-val>.</li><li>Else, let <var>throwOnExtraBits</var> be <emu-val>false</emu-val>.</li><li>Let <var>decodeResult</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="DecodeBase64Chunk" id="_ref_21"><a href="#sec-decodebase64chunk">DecodeBase64Chunk</a></emu-xref>(<var>chunk</var>, <var>throwOnExtraBits</var>)).</li><li>If <var>decodeResult</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, then<ol><li>Let <var>error</var> be <var>decodeResult</var>.<var class="field">[[Value]]</var>.</li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <var>error</var>&nbsp;}.</li></ol></li><li>Set <var>bytes</var> to the <emu-xref href="#list-concatenation"><a href="https://tc39.es/ecma262/#list-concatenation">list-concatenation</a></emu-xref> of <var>bytes</var> and !&nbsp;<var>decodeResult</var>.</li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>length</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <emu-const>none</emu-const>&nbsp;}.</li></ol></li><li>If <var>alphabet</var> is <emu-val>"base64url"</emu-val>, then<ol><li>If <var>char</var> is either <emu-val>"+"</emu-val> or <emu-val>"/"</emu-val>, then<ol><li>Let <var>error</var> be a new <emu-val>SyntaxError</emu-val> exception.</li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <var>error</var>&nbsp;}.</li></ol></li><li>Else if <var>char</var> is <emu-val>"-"</emu-val>, then<ol><li>Set <var>char</var> to <emu-val>"+"</emu-val>.</li></ol></li><li>Else if <var>char</var> is <emu-val>"_"</emu-val>, then<ol><li>Set <var>char</var> to <emu-val>"/"</emu-val>.</li></ol></li></ol></li><li>If the sole code unit of <var>char</var> is not an element of the <emu-xref href="#standard-base64-alphabet" id="_ref_22"><a href="#standard-base64-alphabet">standard base64 alphabet</a></emu-xref>, then<ol><li>Let <var>error</var> be a new <emu-val>SyntaxError</emu-val> exception.</li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <var>error</var>&nbsp;}.</li></ol></li><li>Let <var>remaining</var> be <var>maxLength</var> - the length of <var>bytes</var>.</li><li>If <var>remaining</var> = 1 and <var>chunkLength</var> = 2, or if <var>remaining</var> = 2 and <var>chunkLength</var> = 3, then<ol><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <emu-const>none</emu-const>&nbsp;}.</li></ol></li><li>Set <var>chunk</var> to the <emu-xref href="#string-concatenation"><a href="https://tc39.es/ecma262/#string-concatenation">string-concatenation</a></emu-xref> of <var>chunk</var> and <var>char</var>.</li><li>Set <var>chunkLength</var> to the length of <var>chunk</var>.</li><li>If <var>chunkLength</var> = 4, then<ol><li>Set <var>bytes</var> to the <emu-xref href="#list-concatenation"><a href="https://tc39.es/ecma262/#list-concatenation">list-concatenation</a></emu-xref> of <var>bytes</var> and !&nbsp;<emu-xref aoid="DecodeBase64Chunk" id="_ref_23"><a href="#sec-decodebase64chunk">DecodeBase64Chunk</a></emu-xref>(<var>chunk</var>).</li><li>Set <var>chunk</var> to the empty String.</li><li>Set <var>chunkLength</var> to 0.</li><li>Set <var>read</var> to <var>index</var>.</li><li>If the length of <var>bytes</var> = <var>maxLength</var>, then<ol><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <emu-const>none</emu-const>&nbsp;}.</li></ol></li></ol></li></ol></li></ol></emu-alg>
  </emu-clause>

  <emu-clause id="sec-fromhex" type="abstract operation" aoid="FromHex">
    <h1><span class="secnum">10.4</span> FromHex ( <var>string</var> [ , <var>maxLength</var> ] )</h1>
    <p>The abstract operation FromHex takes argument <var>string</var> (a string) and optional argument <var>maxLength</var> (a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref>) and returns a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> with fields <var class="field">[[Read]]</var> (an <emu-xref href="#integral-number"><a href="https://tc39.es/ecma262/#integral-number">integral Number</a></emu-xref>), <var class="field">[[Bytes]]</var> (a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref>), and <var class="field">[[Error]]</var> (either <emu-const>none</emu-const> or a <emu-val>SyntaxError</emu-val> object). It performs the following steps when called:</p>
    <emu-alg><ol><li>If <var>maxLength</var> is not present, let <var>maxLength</var> be 2<sup>53</sup> - 1.</li><li>Let <var>length</var> be the length of <var>string</var>.</li><li>Let <var>bytes</var> be ¬´&nbsp;¬ª.</li><li>Let <var>read</var> be 0.</li><li>If <var>length</var> <emu-xref aoid="modulo"><a href="https://tc39.es/ecma262/#eqn-modulo">modulo</a></emu-xref> 2 is not 0, then<ol><li>Let <var>error</var> be a new <emu-val>SyntaxError</emu-val> exception.</li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <var>error</var>&nbsp;}.</li></ol></li><li>Repeat, while <var>read</var> &lt; <var>length</var> and the length of <var>bytes</var> &lt; <var>maxLength</var>,<ol><li>Let <var>hexits</var> be the <emu-xref href="#substring"><a href="https://tc39.es/ecma262/#substring">substring</a></emu-xref> of <var>string</var> from <var>read</var> to <var>read</var> + 2.</li><li>If <var>hexits</var> contains any code units which are not in <emu-val>"0123456789abcdefABCDEF"</emu-val>, then<ol><li>Let <var>error</var> be a new <emu-val>SyntaxError</emu-val> exception.</li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <var>error</var>&nbsp;}.</li></ol></li><li>Set <var>read</var> to <var>read</var> + 2.</li><li>Let <var>byte</var> be the <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref> value represented by <var>hexits</var> in base-16 notation, using the letters A-F and a-f for digits with values 10 through 15.</li><li>Append <var>byte</var> to <var>bytes</var>.</li></ol></li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Read]]</var>: <var>read</var>, <var class="field">[[Bytes]]</var>: <var>bytes</var>, <var class="field">[[Error]]</var>: <emu-const>none</emu-const>&nbsp;}.</li></ol></emu-alg>
  </emu-clause>

  <!-- Copied from ECMA-402/Temporal -->

  <emu-clause id="sec-getoptionsobject" aoid="GetOptionsObject">
    <h1><span class="secnum">10.5</span> GetOptionsObject ( <var>options</var> )</h1>
    <emu-alg><ol><li>If <var>options</var> is <emu-val>undefined</emu-val>, then<ol><li>Return <emu-xref aoid="OrdinaryObjectCreate"><a href="https://tc39.es/ecma262/#sec-ordinaryobjectcreate">OrdinaryObjectCreate</a></emu-xref>(<emu-val>null</emu-val>).</li></ol></li><li>If <emu-xref aoid="Type"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>options</var>) is Object, then<ol><li>Return <var>options</var>.</li></ol></li><li>Throw a <emu-val>TypeError</emu-val> exception.</li></ol></emu-alg>
  </emu-clause>
</emu-clause>

<emu-annex id="sec-modified-bibliography">
  <h1><span class="secnum">A</span> Bibliography</h1>
  <p>NOTE: We need to add RFC 4648 to the bibliography as part of landing this upstream.</p>
  <ol>
    <li>
      <ins><i>RFC 4648 ‚ÄúThe Base16, Base32, and Base64 Data Encodings‚Äù</i>, available at &lt;<a href="https://datatracker.ietf.org/doc/html/rfc4648">https://datatracker.ietf.org/doc/html/rfc4648</a></ins>&gt;
    </li>
  </ol>
</emu-annex>
</div></body>